<?php

namespace Module\{%uModuleName%}\V1\Controller;

use App\Controller\BaseController;
use App\Repository\GetItemInterface;
use Exception;
use Module\{%uModuleName%}\V1\Entity\{%entityName%};
use Module\{%uModuleName%}\V1\Service\{%entityName%}Service;
use Nelmio\ApiDocBundle\Annotation\Model;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Nelmio\ApiDocBundle\Annotation\Security;
use OpenApi\Attributes as OA;

#[OA\Response(
    response: 200,
    description: 'Get model {%lModuleName%}',
    content: new OA\JsonContent(
        properties: [
            new OA\Property(property: 'success', type: 'boolean', default: true),
            new OA\Property(property: 'code', type: 'integer', default: 200),
            new OA\Property(
                property: 'item',
                ref: new Model(type: {%entityName%}::class, groups: ["list"])
            ),
        ]
    )
)]
#[OA\Response(
    response: 500,
    description: 'Returns error',
    content: new OA\JsonContent(
        properties: [
            new OA\Property(property: 'success', type: 'boolean', default: false),
            new OA\Property(property: 'code', type: 'integer'),
            new OA\Property(property: 'message', type: 'integer'),
        ]
    )
)]
#[Security(name: 'Bearer')]
#[OA\Tag(name: '{%lModuleName%}')]
#[Route(path: '/v1/{%lModuleName%}/{id<\d+>}', name: '{%lModuleName%}Get', methods: Request::METHOD_GET)]
class GetController extends BaseController
{
    final public function __invoke(int $id, {%entityName%}Service $service): Response
    {
        try {
            $repository = $service->getRepository();
            if (!$repository instanceof GetItemInterface) {
                throw new Exception('Repository not implements GetItemInterface');
            }
            $item = $repository->getItem($id);
            if ($item === null) {
                return $this->json([
                    'success' => false,
                    'code' => Response::HTTP_NOT_FOUND,
                    'message' => 'Entity not found'
                ]);
            }

            return $this->json([
                'success' => true,
                'code' => Response::HTTP_OK,
                'item' => $item,
            ]);
        } catch (Exception $e) {
            return $this->json([
                'success' => false,
                'code' => Response::HTTP_EXPECTATION_FAILED,
                'message' => $e->getMessage(),
            ]);
        }
    }
}